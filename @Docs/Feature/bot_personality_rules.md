# 机器人人设管理功能规则

## 📋 功能概述

机器人人设管理系统支持用户创建、编辑和管理多个机器人角色的详细人格设定，包括基础信息、生活习惯、价值观、人生经历等全方位的角色塑造。

## 🎯 核心功能

### 1. 多机器人管理
- **机器人列表**：左侧显示用户的所有机器人，支持快速切换
- **机器人卡片**：显示基础信息（姓名、国籍、年龄、工作、爱好）
- **CRUD操作**：创建、编辑、删除机器人，包含确认对话框
- **选中状态**：视觉化显示当前编辑的机器人

### 2. 详细人设配置
- **基础信息**：姓名、国籍、年龄、性别、身高体重、血型、星座等
- **作息习惯**：起床、用餐、工作、休息、假期等时间安排
- **个人喜好**：音乐、电影、时尚、发型、美食、餐厅偏好
- **背景资料**：教育背景、婚姻状况、家庭成员信息
- **价值观念**：兴趣爱好、世界观、人生哲学、价值观
- **人生经历**：童年、成长、恋爱、工作、商业、投资经历
- **未来规划**：旅行计划、人生梦想、未来思考

### 3. 图片管理
- **五类图片**：个人、生活、工作、爱好、旅行照片
- **拖拽上传**：支持多文件批量上传
- **图片描述**：为每张图片添加描述信息
- **排序管理**：支持图片顺序调整

## 🏗️ 技术架构

### 数据库设计
```sql
-- 机器人人设主表
bot_personalities (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id),
    bot_name VARCHAR(100) NOT NULL,
    -- 50+ 个人设字段
    daily_routine JSONB,        -- 作息时间
    life_timeline JSONB,        -- 人生时间轴
    family_members JSONB,       -- 家庭成员
    created_at, updated_at, is_active
)

-- 机器人图片表
bot_images (
    id UUID PRIMARY KEY,
    bot_id UUID REFERENCES bot_personalities(id),
    image_type VARCHAR(30),     -- personal/lifestyle/work/hobby/travel
    image_url TEXT,
    description TEXT,
    sort_order INTEGER
)
```

### 安全策略
- **行级安全(RLS)**：用户只能访问自己创建的机器人
- **级联删除**：删除机器人时自动删除相关图片
- **文件存储**：使用Supabase Storage管理图片文件

## 🎨 UI/UX 设计规范

### 布局架构
```
┌─────────────────┬──────────────────────────────────────┐
│   机器人列表     │            内容编辑区                │
│   280px 宽度    │                                      │
│                 │  ┌─────────────────────────────────┐  │
│ ┌─────────────┐ │  │        顶部工具栏              │  │
│ │  机器人卡片  │ │  ├─────────────────────────────────┤  │
│ │  + 操作按钮  │ │  │        标签页导航              │  │
│ └─────────────┘ │  ├─────────────────────────────────┤  │
│                 │  │                                │  │
│ [+ 新建机器人]   │  │        表单内容区               │  │
│ [语言切换]      │  │                                │  │
└─────────────────┴──────────────────────────────────────┘
```

### 组件规范

#### 机器人卡片 (BotCard)
- **选中状态**：蓝色边框 + `neumorphic-subtle` 阴影
- **hover效果**：显示编辑、删除按钮 (`action-buttons-hover`)
- **信息层次**：头像→姓名→基础信息→描述→时间戳

#### 表单字段 (PersonalityFormField)
- **统一样式**：使用CSS变量，支持深色模式
- **字段类型**：
  - 基础输入框：文本、数字、日期
  - 下拉选择：性别、血型、教育水平、婚姻状况
  - 长文本域：地址、工作、经历类字段
  - 复杂结构：作息时间、人生时间轴、家庭成员

#### 复杂字段设计
- **作息时间**：7个时间字段的表格式输入
- **人生时间轴**：可添加/删除的事件卡片，支持年月日
- **家庭成员**：可添加/删除的成员信息表单

### 交互规范
- **操作按钮**：统一使用hover显示模式
- **确认对话框**：删除操作需要用户二次确认
- **状态反馈**：保存中、加载中等状态提示
- **表单验证**：必填字段标红星，实时验证

## 🌍 多语言支持

### 实现方式
- **代码映射**：数据库存储英文，UI层动态翻译
- **支持语言**：中文(zh)、越南语(vi)
- **标签类型**：
  - `BOT_PERSONALITY_LABELS`：字段标签
  - `IMAGE_TYPE_LABELS`：图片类型标签
  - `CATEGORY_LABELS`：分类标签
  - `COMMON_LABELS`：通用标签

### 标签获取
```typescript
const label = getLabel(fieldKey, language)
// 示例：getLabel('bot_name', 'zh') => "机器人名称"
```

## 📂 文件结构

```
src/app/bots/
├── page.tsx                 # 主页面组件（500+行）
├── components/
│   ├── BotCard              # 机器人卡片组件
│   └── BotFormTabs          # 表单标签页组件

src/components/ui/
├── personality-form-field.tsx  # 表单字段组件（344行）
├── image-upload.tsx            # 图片上传组件
├── modal.tsx                   # 模态框组件
└── button.tsx                  # 按钮组件

src/lib/
├── types/bot-personality.ts    # 类型定义
├── bot-personality-lang.ts     # 多语言标签
└── api/bot-personality/        # API接口
```

## 🔒 数据验证规则

### 必填字段
- `bot_name`：机器人名称（最大100字符）

### 数据格式
- `age`：正整数，0-150
- `birth_date`：标准日期格式
- `daily_routine`：JSON对象，包含7个时间字段
- `life_timeline`：JSON数组，每个事件包含year、event、description
- `family_members`：JSON数组，包含8个字段的成员信息

### 图片规则
- **文件类型**：JPEG、PNG、WEBP
- **文件大小**：最大10MB
- **数量限制**：每个类型最多20张图片

## 🚀 扩展性考虑

### 功能扩展点
1. **搜索过滤**：在机器人列表中添加搜索功能
2. **批量操作**：支持批量删除、导入导出
3. **模板系统**：预设机器人人设模板
4. **角色标签**：为机器人添加分类标签
5. **AI生成**：基于提示词自动生成人设

### 性能优化
1. **虚拟滚动**：处理大量机器人列表
2. **图片压缩**：自动优化上传图片
3. **离线缓存**：支持离线编辑功能
4. **数据分页**：分页加载大量数据

## 📋 开发指南

### 新增字段
1. 在 `bot-personality.ts` 中添加类型定义
2. 在 `bot-personality-lang.ts` 中添加多语言标签
3. 在 `PersonalityFormField` 中添加字段渲染逻辑
4. 更新数据库schema并执行迁移

### 新增语言
1. 在 `Language` 类型中添加语言代码
2. 在各个标签对象中添加对应翻译
3. 在语言切换组件中添加选项

### 自定义字段类型
1. 在 `PersonalityFormField` 的 `renderField()` 中添加case
2. 实现对应的渲染函数
3. 确保支持深色模式和响应式设计

## 🎯 质量保证

### 测试要点
- [ ] 多机器人创建、编辑、删除
- [ ] 复杂字段数据保存和恢复
- [ ] 图片上传和管理
- [ ] 多语言切换
- [ ] 深色模式兼容性
- [ ] 响应式布局

### 性能指标
- 页面加载时间 < 2秒
- 表单提交响应时间 < 1秒
- 图片上传成功率 > 98%
- 多机器人切换响应时间 < 500ms

## 📈 后续迭代

### 版本规划
- **v1.0**：基础多机器人管理 ✅
- **v1.1**：搜索过滤、批量操作
- **v1.2**：模板系统、角色标签
- **v2.0**：AI辅助生成、高级分析

### 用户反馈收集
- 表单填写体验
- 多机器人管理效率
- 界面布局合理性
- 功能完整性评估 